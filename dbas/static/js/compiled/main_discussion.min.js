var colors=["#F44336","#673AB7","#03A9F4","#4CAF50","#FFEB3B","#FF5722","#607D8B","#E91E63","#3F51B5","#00BCD4","#8BC34A","#FFC107","#795548","#000000","#9C27B0","#2196F3","#009688","#CDDC39","#FF9800","#9E9E9E"],highlightColors=["#e57373","#9575cd","#64b5f6","#81c784","#fff176","#ff8a65","#90a4ae","#f06292","#7986cb","#4dd0e1","#aed581","#ffd54f","#a1887f","#424242","#ba68c8","#64b5f6","#4db6ac","#dce775","#ffb74d","#e0e0e0"];function DiscussionBarometer(){this.showBarometer=function(){var c=0,b=[],a=window.location.href.split("?")[0],e=a.split("/"),d="position";if(a.indexOf("/attitude/")!=-1){d="attitude";c=e[e.length-1];new AjaxGraphHandler().getUserGraphData(c,d)}else{if(a.indexOf("/justify/")!=-1||window.location.href.indexOf("/choose/")!=-1){d="justify";$("#discussions-space-list li:not(:last-child) input").each(function(){b.push($(this).attr("id").substr(5))});new AjaxGraphHandler().getUserGraphData(b,d)}else{if(a.indexOf("/reaction/")!=-1){d="argument";b.push(e[e.length-3]);b.push(e[e.length-1]);new AjaxGraphHandler().getUserGraphData(b,d)}else{d="position";$("#discussions-space-list li:not(:last-child) label").each(function(){b.push($(this).attr("id"))});new AjaxGraphHandler().getUserGraphData(b,d)}}}};this.callbackIfDoneForGetDictionary=function(c,a){var f,b=new DiscussionBarometer();try{f=JSON.parse(c);console.log(f)}catch(d){setGlobalErrorHandler(_t_discussion(ohsnap),_t_discussion(internalError));alert("parsing-json: "+d);return}$("#"+popupConfirmDialogId).modal("show");$("#"+popupConfirmDialogId+" div.modal-body").html('<canvas id="chartCanvas" width="400" height="400" style= "display: block; margin: 0 auto; margin-bottom: 20px;"></canvas>');$("#"+popupConfirmDialogAcceptBtn).show().click(function(){$("#"+popupConfirmDialogId).modal("hide")}).removeClass("btn-success");$("#"+popupConfirmDialogRefuseBtn).hide();switch(a){case"attitude":b.createAttitudeBarometer(f);break;case"position":b.createStatementBarometer(f);break;case"justify":b.createStatementBarometer(f);break;case"argument":b.createArgumentBarometer(f);break}$("#"+popupConfirmDialogId).find(".modal-title").text(f.title).css({"line-height":"1.0"})};this.createAttitudeBarometer=function(c){$("#"+popupConfirmDialogId+" h4.modal-title").html(c.text);var a=$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").get(0).getContext("2d");var d=[{value:c.agree_users.length,color:colors[3],highlight:highlightColors[3],label:c.agree_text},{value:c.disagree_users.length,color:colors[0],highlight:highlightColors[0],label:c.disagree_text}];if(c.agree_users.length+c.disagree_users.length==0){this.setAlertIntoDialog();$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").remove()}else{options=new DiscussionBarometer().createLegendOptions();var b=new Chart(a).Pie(d,options);new DiscussionBarometer().createLegend(b)}};this.createStatementBarometer=function(e){var a=$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").get(0).getContext("2d"),d=new Chart(a).Pie(),c=0,f=0;$.each(e.opinions,function(g,h){if(h.text!=null){d.addData({value:h.users.length,color:colors[c],highlight:highlightColors[c],label:h.text});f+=h.users.length;c+=1}});if(f==0){this.setAlertIntoDialog();$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").remove()}else{var b=new DiscussionBarometer().createLegendOptions();$.extend(d.options,b);new DiscussionBarometer().createLegend(d)}};this.createArgumentBarometer=function(e){var a=$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").get(0).getContext("2d"),d=new Chart(a).Pie(),c=0,f=0;$.each(e.opinions,function(g,h){if(g!="error"){d.addData({value:h.users.length,color:colors[c],highlight:highlightColors[c],label:h.text});f+=h.users.length;c+=1}});if(f==0){this.setAlertIntoDialog();$("#"+popupConfirmDialogId+" div.modal-body #chartCanvas").remove()}else{var b=new DiscussionBarometer().createLegendOptions();$.extend(d.options,b);new DiscussionBarometer().createLegend(d)}};this.createLegendOptions=function(){return options={legendTemplate:'<ul class = "chart"><% for (var i=0; i<segments.length; i++) { %><li class = "chart"><span class = "chart" style = "background-color: <%=segments[i].fillColor%>"> </span><% if (segments[i].label) { %><%= segments[i].label %><% } %><% if (segments[i].value == 0) { %><%= " (0 " + _t_discussion(votes) + ")" %><% } %><% if (segments[i].value == 1) { %><%= " (" + segments[i].value + " " + _t_discussion(vote) + ")" %><% } %><% if (segments[i].value > 1) { %><%= " (" + segments[i].value + " " + _t_discussion(votes) + ")" %><% } %></li><% } %></ul>',tooltipTemplate:"<%=value%>"}};this.createLegend=function(b){var a=b.generateLegend();$("#"+popupConfirmDialogId+" div.modal-body").append('<div id = "chart-legend">'+a+"</div>")};this.setAlertIntoDialog=function(){var c,a,b;c=$("<div>").attr("class","alert alert-dismissible alert-info");a=$("<strong>").text("Ohh...! ");b=$("<span>").text(_t_discussion(noDecisionstaken));c.append(a).append(b);$("#"+popupConfirmDialogId+" div.modal-body").append(c);$("#"+popupConfirmDialogId).on("hidden.bs.modal",function(d){c.remove()})};this.callbackIfFailForGetDictionary=function(){setGlobalErrorHandler(_t(ohsnap),_t_discussion(requestFailed))}};function DiscussionGraph(){var a;this.showGraph=function(){new AjaxGraphHandler().getDiscussionGraphData("/graph/d3")};this.callbackIfDoneForDiscussionGraph=function(d){var b=$.parseJSON(d);try{a=new DiscussionGraph().setDefaultViewParams(true,b,null)}catch(c){new DiscussionGraph().setDefaultViewParams(false,null,a);setGlobalErrorHandler(_t(ohsnap),_t(internalError))}};this.setDefaultViewParams=function(f,d,c){$("#hide-content").hide();$("#show-content").show();$("#wide-view").show();$("#tight-view").hide();var b=$("#"+graphViewContainerSpaceId);b.empty();if(f){try{return this.getD3Graph(d)}catch(e){new DiscussionGraph().setDefaultViewParams(false,null,c);setGlobalErrorHandler("Oh Snap!",_t(internalError));console.log("D3: "+e.message)}}else{b.empty()}};this.getD3Graph=function(m){var c=$("#"+graphViewContainerSpaceId);c.empty();var e=c.width();var o=c.outerHeight();var k=d3.select("#"+graphViewContainerSpaceId).append("svg").attr("width",e).attr("height",o);var d=d3.layout.force().gravity(0.07).charge(-300).linkDistance(80).size([e,o]);var i=[];m.edges.forEach(function(r){var p=m.nodes.filter(function(s){return s.id===r.source})[0],q=m.nodes.filter(function(s){return s.id===r.target})[0];i.push({source:p,target:q,color:r.color})});d.links(i).nodes(m.nodes).on("tick",h);var j=k.append("defs").selectAll("marker").data(i).enter().append("svg:marker").attr("id",function(p){return"marker_"+p.color}).attr("refX",10).attr("refY",2.2).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M0,0 V4 L5,2 Z10").attr("fill",function(p){return p.color});var l=k.selectAll(".link").data(i).enter().append("line").attr("class","link").style("stroke",function(p){return p.color}).style("stroke-width","2px").attr("marker-end",function(p){return"url(#marker_"+p.color+")"});var g=k.selectAll(".node").data(d.nodes()).enter().append("g").attr("class","node").call(d.drag);var b=g.append("circle").attr("r",function(p){return p.size}).attr("fill",function(p){return p.color});var f=new Helper();var n=g.append("text").each(function(q){var p=f.cutTextOnChar(q.label,50," ");d3.select(this).append("tspan").text(p).attr("dy","1.2em").attr("x","0").attr("text-anchor","middle").attr("class","tspan")});d.start();function h(){l.attr("x1",function(p){return p.source.x}).attr("y1",function(p){return p.source.y}).attr("x2",function(p){return p.target.x}).attr("y2",function(p){return p.target.y});b.attr("cx",function(p){return p.x}).attr("cy",function(p){return p.y});n.attr("transform",function(p){return"translate("+p.x+","+(p.y-50)+")"})}}};function DiscussionGraph(){var a;this.showGraph=function(){new AjaxGraphHandler().getDiscussionGraphData("/graph/sigma")};this.callbackIfDoneForDiscussionGraph=function(e){var c=$.parseJSON(e);try{a=new DiscussionGraph().setDefaultViewParams(true,c,null)}catch(d){new DiscussionGraph().setDefaultViewParams(false,null,null);setGlobalErrorHandler(_t(ohsnap),_t(internalError));return}var b=sigma.plugins.dragNodes(a,a.renderers[0]);b.bind("startdrag",function(f){a.stopForceAtlas2()});b.bind("drop",function(f){});$("#graph-view-container-space").attr("style","height:95%; float: left;");$("#start-view").click(function(){new DiscussionGraph().setDefaultViewParams(true,c,a)});$("#show-content").click(function(){a.settings({labelThreshold:0,defaultLabelColor:"#2E2E2E"});$("#show-content").hide();$("#hide-content").show()});$("#hide-content").click(function(){a.settings({labelThreshold:8});$("#show-content").show();$("#hide-content").hide()});$("#wide-view").click(function(){if(!a.isForceAtlas2Running()){a.startForceAtlas2({worker:true,linLogMode:false,strongGravityMode:true,barnesHutTheta:10,scalingRatio:20})}$("#wide-view").hide();$("#tight-view").show();a.configForceAtlas2({strongGravityMode:false,linLogMode:true,outboundAttractionDistribution:false})});$("#tight-view").click(function(){a.configForceAtlas2({outboundAttractionDistribution:true});$("#wide-view").show();$("#tight-view").hide()});$("#snapshot-graph").click(function(){var f=new Date(Date.now());var g=f.getYear+"-"+f.getMonth+"-"+f.getHours();g+="_"+f.getMinutes()+"-"+f.getSeconds();g+="_"+new Helper().getCurrentIssueId();window.open(a.renderers[0].snapshot({format:"png",background:"white",filename:g+".png",labels:false}))});$("#"+closeGraphViewContainerId).click(function(){new DiscussionGraph().setDefaultViewParams(false,null,a)})};this.setDefaultViewParams=function(b,c,e){$("#hide-content").hide();$("#show-content").show();$("#wide-view").show();$("#tight-view").hide();if(e!=null){e.stopForceAtlas2();e.killForceAtlas2();e.graph.clear();e.graph.kill()}$("#"+graphViewContainerSpaceId).empty();if(b){try{return this.getSigmaGraph(c)}catch(d){new DiscussionGraph().setDefaultViewParams(false,null,e);setGlobalErrorHandler(_t(ohsnap),_t(internalError))}}else{$("#"+graphViewContainerSpaceId).empty()}};this.getSigmaGraph=function(b){$("#"+graphViewContainerSpaceId).empty();return new sigma({graph:b,renderer:{type:"canvas",container:graphViewContainerSpaceId},settings:{edgeColor:"default",defaultEdgeColor:"#666",defaultEdgeLabelColor:"#848484",defaultEdgeLabelSize:8,edgeLabelSize:"proportional",edgeLabelSizePowRatio:1,edgeLabelThreshold:0,defaultLabelHoverColor:"node",defaultHoverLabelBGColor:"#EBEBEB",defaultLabelSize:13,defaultNodeType:"border",defaultNodeBorderColor:"#000",borderSize:3,enableEdgeHovering:true,edgeHoverColor:"edge",defaultEdgeHoverColor:"#000",edgeHoverSizeRatio:1,edgeHoverExtremities:true,doubleClickEnabled:false,hideEdgesOnMove:false,zoomMin:0.2,zoomMax:1,minArrowSize:10,maxEdgeSize:2,sideMargin:1}}).startForceAtlas2({worker:true,strongGravityMode:true,barnesHutTheta:10,scalingRatio:20}).bind("doubleClickNode",function(j){var h=j.data.node.id.substr(j.data.node.id.indexOf("_")+1);var c="";var f='<img class="preload-image" style="height: 20pt; margin-right: 1em;" src="'+b.extras[h].author_gravatar+'">';var d='<a target="_blank" href="'+mainpage+"user/"+b.extras[h].author+'">';var i='<a target="_blank" href="'+mainpage+"user/"+b.extras[h].modifier+'">';var g="<ul>";g+="<li>Content: "+j.data.node.label+"</li>";g+="<li>Node: "+j.data.node.id+"</li>";g+="<li>Supporters: "+b.extras[h].votes+"</li>";g+="<li>Author: "+i+b.extras[h].author+" "+f+"</a></li>";if(b.extras[h].was_modified==="true"){c='<img class="preload-image" style="height: 20pt; margin-right: 1em;" src="'+b.extras[h].modifier_gravatar+'">';g+="<li>Edit by: "+d+b.extras[h].modifier+" "+c+"</a></li>"}g+="</ul>";displayConfirmationDialogWithoutCancelAndFunction("Statement "+h,g)}).refresh()}};function GuiHandler(){var a;var b=300;this.setHandler=function(c){a=c};this.appendAddPremiseRow=function(){var f=$("#add-premise-container-body");var e=$("#"+sendNewPremiseId);var h=new Date().getTime();var c=$("<div>").attr("style","padding-bottom: 2em").addClass("container-three-divs");var k=$("<div>").addClass("flex-div");var g=$("<div>");var d="add-premise-container-main-input-"+h;var l=$("<input>").attr("id",d).attr("type","text").attr("class","form-control").attr("autocomplete","off").attr("placeholder","...").data("min-length","10").keyup(function(){setTextWatcherForMinLength($(this))}).focusin(function(){setTextWatcherForMinLength($(this))});var j=$("<img>").attr("class","icon-rem-premise").attr("src",mainpage+"static/images/icon_minus1.png").attr("title",f.find(".icon-rem-premise").first().attr("title"));var i=$("<img>").attr("class","icon-add-premise").attr("src",mainpage+"static/images/icon_plus1.png").attr("title",f.find(".icon-add-premise").first().attr("title"));c.append(k.append(l)).append(g.append(j).append(i));$("#"+addPremiseContainerBodyId).append(c);i.click(function(){new GuiHandler().appendAddPremiseRow();$(this).hide().prev().show();e.val(_t(saveMyStatements))});f.find(".icon-rem-premise").each(function(){$(this).click(function(){var n=$(this).parent().parent().find("input").attr("id"),m=n.split("-").length==6?n.split("-")[5]:"0";$("#current_"+m).fadeOut().remove();$(this).parent().parent().remove();f.find("div").children().last().show();if(f.find(".container-three-divs").length==1){f.find(".icon-rem-premise").hide();e.val(_t(saveMyStatement))}else{f.find(".icon-rem-premise").show();e.val(_t(saveMyStatements))}})});j.show();$("#"+d).keyup(function(){new Helper().delay(function(){var m=new Helper().escapeHtml($("#"+d).val());new AjaxDiscussionHandler().fuzzySearch(m,d,fuzzy_add_reason,"")},200)})};this.setErrorDescription=function(c){$("#"+discussionErrorDescriptionId).html(c);$("#"+discussionErrorDescriptionSpaceId).show()};this.setDisplayStyleAsDiscussion=function(){this.setImageInactive($("#"+displayStyleIconGuidedId));this.setImageActive($("#"+displayStyleIconIslandId));this.setImageActive($("#"+displayStyleIconExpertId));$("#"+islandViewContainerId).hide();$("#"+graphViewContainerId).hide();$("#"+discussionContainerId).show();$("#"+headerContainerId).show()};this.setDisplayStyleAsIsland=function(){this.setImageActive($("#"+displayStyleIconGuidedId));this.setImageInactive($("#"+displayStyleIconIslandId));this.setImageActive($("#"+displayStyleIconExpertId));$("#"+islandViewContainerId).fadeIn("slow")};this.setDisplayStyleAsGraphView=function(){var d=$("#"+graphViewContainerId);var c=new Main();var e="tacked_graph_sidebar";var g=$("#graph-view-container-header");this.setImageActive($("#"+displayStyleIconGuidedId));this.setImageActive($("#"+displayStyleIconIslandId));this.setImageInactive($("#"+displayStyleIconExpertId));$("#"+islandViewContainerId).hide();$("#"+discussionContainerId).hide();$("#"+headerContainerId).hide();$("#"+addPremiseContainerId).hide();$("#"+graphViewContainerHeaderId).html($("#issue_info").html());var f=new Helper().getMaxSizeOfGraphViewContainer();d.attr("style","height: "+f+"px; margin-left: 2em; margin-right: 2em; margin-bottom: 1em;");f-=g.outerHeight(true)+20;$("#"+graphViewContainerSpaceId).attr("style","height: "+f+"px; margin-left: 0.5em; margin-right: 0.5em; width: 95%");new DiscussionGraph().showGraph();c.setSidebarStyle(d,e);c.setSidebarClicks(d,e)};this.setImageInactive=function(c){c.addClass("inactive-image").css("cursor","not-allowed")};this.setImageActive=function(c){c.removeClass("inactive-image").css("cursor","pointer")};this.setMaxHeightForBubbleSpace=function(){var d=$("#"+discussionBubbleSpaceId),c=0,e=new Helper().getMaxSizeOfDiscussionViewContainer(),g,f=d.find("*[id*=now]");$.each(d.find("div p"),function(){c+=$(this).outerHeight(true);if($(this).parent().attr("href")=="?breadcrumb=true"){$(this).insertAfter($(this).parent());$(this).prev().remove()}});g=f.length==0?"bottom":f;if(c>e){if(e<b){e=b}d.slimscroll({position:"right",height:e+"px",railVisible:true,alwaysVisible:true,start:g,scrollBy:"10px",allowPageScroll:true})}else{c+=20;if(c<50){d.css("min-height","100px")}else{d.css("height",c+"px").css("min-height","300px")}d.css("min-height","100px").css("max-height",e+"px")}};this.showAddPositionContainer=function(){$("#"+addStatementContainerId).show()};this.showAddPremiseContainer=function(){$("#"+addPremiseContainerId).show()};this.showSetStatementContainer=function(i,t,s,c,e,h,u){var r=new GuiHandler(),d,q,k=$("#"+popupSetPremiseGroupsBodyContent).empty(),l=$("#"+popupSetPremiseGroupsPreviousButton).hide(),m=$("#"+popupSetPremiseGroupsNextButton).hide(),g=$("#"+popupSetPremiseGroupsSendButton).addClass("disabled"),j=$("#"+popupSetPremiseGroupsCounter).hide(),o="insert_statements_page_";g.click(function f(){var x=k.find("input:checked"),w,v,y;for(w=0;w<i.length;w++){y=i[w].split(" "+_t_discussion(and)+" ");if(x[w].id.indexOf(attr_more_args)!=-1){for(v=0;v<y.length;v++){t.push([y[v]])}}else{if(x[w].id.indexOf(attr_one_arg)!=-1){t.push(y)}else{t.push([i[w]])}}}if(c==fuzzy_add_reason){new AjaxDiscussionHandler().sendNewPremiseForArgument(e,h,t)}else{if(c==fuzzy_start_premise){new AjaxDiscussionHandler().sendNewStartPremise(t,u,s)}else{alert("Todo: unknown type")}}$("#"+popupSetPremiseGroups).modal("hide")});if(i.length==1){d=r.getPageOfSetStatementContainer(0,i[0]);k.append(d);g.text(_t_discussion(saveMyStatement));d.find("input").each(function(){$(this).click(function v(){g.removeClass("disabled")})})}else{l.show().removeClass("href").attr("max",i.length);l.parent().addClass("disabled");m.show().attr("max",i.length);j.show().text("1/"+i.length);g.text(_t(saveMyStatements));for(q=0;q<i.length;q++){d=r.getPageOfSetStatementContainer(q,i[q]);if(q>0){d.hide()}k.append(d);d.find("input").each(function(){$(this).click(function v(){new GuiHandler().displayNextPageOffSetStatementContainer(k,l,m,j,o)})})}l.click(function n(){new GuiHandler().displayPrevPageOffSetStatementContainer(k,l,m,j,o)});m.click(function p(){new GuiHandler().displayNextPageOffSetStatementContainer(k,l,m,j,o)})}$("#"+popupSetPremiseGroups).modal("show")};this.displayNextPageOffSetStatementContainer=function(d,g,f,c,i){var h=d.find("div:visible"),j=parseInt(h.attr("id").substr(i.length)),e=h.find("input:checked");if(e.length==0){$("#insert_statements_page_error").fadeIn()}else{$("#insert_statements_page_error").fadeOut();if(j<(parseInt(f.attr("max"))-1)){h.hide().next().fadeIn();g.parent().removeClass("disabled");c.show().text((j+2)+"/"+f.attr("max"));if((j+2)==parseInt(f.attr("max"))){f.parent().addClass("disabled")}}else{$("#"+popupSetPremiseGroupsSendButton).removeClass("disabled")}}};this.displayPrevPageOffSetStatementContainer=function(d,f,e,c,h){var g=d.find("div:visible"),i=parseInt(g.attr("id").substr(h.length));if(i>0){g.hide().prev().fadeIn();e.parent().removeClass("disabled");c.show().text((i)+"/"+f.attr("max"));if(i==0){f.parent().addClass("disabled")}}};this.getPageOfSetStatementContainer=function(r,s){var c=$("#insert_statements_page_");var p=c.clone();var e=c.attr("id");var o=s.split(" "+_t_discussion(and)+" ");var k=$("#"+addPremiseContainerMainInputIntroId).text();var h,g,f,n,l,q,d,j,m;k=k.substr(0,k.length-3);$("#popup-set-premisegroups-body-intro-statements").text(s.trim());if(k.match(/\.$/)){k=k.substr(0,k.length-1)+", "}p.attr("id",e+r).attr("page",r).show();p.find("#"+popupSetPremiseGroupsStatementCount).text(o.length);n=p.find("#"+popupSetPremiseGroupsListMoreArguments);q=p.find("#"+popupSetPremiseGroupsOneBigStatement);h=p.find("#insert_more_arguments");g=p.find("#insert_one_argument");f=p.find("#insert_dont_care");h.attr("id",h.attr("id")+"_"+r);g.attr("id",g.attr("id")+"_"+r);f.attr("id",f.attr("id")+"_"+r);h.attr("name",h.attr("name")+"_"+r);g.attr("name",g.attr("name")+"_"+r);f.attr("name",f.attr("name")+"_"+r);h.parent().attr("for",h.parent().attr("for")+"_"+r);g.parent().attr("for",g.parent().attr("for")+"_"+r);f.parent().attr("for",f.parent().attr("for")+"_"+r);d=_t_discussion(isItTrueThat);if(getDiscussionLanguage()=="de"){l=k}else{l=k+" "+d}for(j=0;j<o.length;j++){n.append($("<li>").text(k+" "+o[j]+"."));m=j==0?"":("<em>"+_t_discussion(andAtTheSameTime)+"</em> "+d+" ");l+=" "+m+o[j]}q.html(new Helper().startWithUpperCase(l)+".");return p};this.setStatementsAsProposal=function(o,n,l){var k=$("#"+n),j;if(l==fuzzy_start_premise){$("#"+proposalPremiseListGroupId).empty()}else{if(l==fuzzy_start_statement){$("#"+proposalStatementListGroupId).empty()}else{if(l==fuzzy_add_reason){$("#"+proposalPremiseListGroupId).empty()}else{if(l==fuzzy_statement_popup){$("#"+proposalEditListGroupId).empty()}else{if(l==fuzzy_find_user){$("#"+proposalUserListGroupId).empty()}}}}}if(o.length==0){return}var d,g,e,i,c,h,m,f;k.focus();$.each(o.values,function(p,q){c=parseInt(q.distance);h=q.index;d=k.val();j=q.text;m=q.text.replace(new RegExp("("+(d+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")+")","gi"),"</b>$1<b>");g=$("<button>").attr("type","button").attr("class","list-group-item").attr("id","proposal_"+h).attr("text",j).hover(function(){$(this).addClass("active")},function(){$(this).removeClass("active")});e=$("<span>").attr("class","badge").text(o.distance_name+" "+c);i=$("<span>").attr("id","proposal_"+h+"_text").html(m);f=$("<img>").addClass("preload-image").attr("style","height: 20pt;, margin-right: 1em;").attr("src",q.avatar);g.append(f).append(e).append(i).click(function(){k.val($(this).attr("text"));$("#"+proposalStatementListGroupId).empty();$("#"+proposalPremiseListGroupId).empty();$("#"+proposalEditListGroupId).empty();$("#"+proposalUserListGroupId).empty()});if(l==fuzzy_start_premise){$("#"+proposalPremiseListGroupId).append(g)}else{if(l==fuzzy_start_statement){$("#"+proposalStatementListGroupId).append(g)}else{if(l==fuzzy_add_reason){$("#"+proposalPremiseListGroupId).append(g)}else{if(l==fuzzy_statement_popup){$("#"+proposalEditListGroupId).append(g)}else{if(l==fuzzy_find_user){$("#"+proposalUserListGroupId).append(g)}}}}}})};this.showEditStatementsPopup=function(){var f,h,e,g,d=new Helper(),c=[];$("#"+popupEditStatementId).modal("show");$("#"+popupEditStatementWarning).hide();f=$("<table>").attr("class","table table-condensed table-hover").attr("border","0").attr("style","border-collapse: separate; border-spacing: 5px 5px;");e=$("<td>").html("<strong>"+_t_discussion(text)+"</strong>").css("text-align","center");g=$("<td>").html("<strong>"+_t_discussion(options)+"</strong>").css("text-align","right");f.append($("<tr>").append(e).append(g));$("#"+discussionSpaceId+" li:not(:last-child) label:nth-child(even)").each(function(){h=d.createRowInEditDialog($(this).text(),$(this).attr("for").substr("item_".length),$(this).attr("id"));if($.inArray($(this).attr("id"),c)==-1){f.append(h);c.push($(this).attr("id"))}});$("#"+popupEditStatementContentId).empty().append(f);$("#"+popupEditStatementTextareaId).hide();$("#"+popupEditStatementDescriptionId).hide();$("#"+popupEditStatementSubmitButtonId).hide();$("#"+proposalEditListGroupId).empty()};this.showUrlSharingPopup=function(){$("#"+popupUrlSharingId).modal("show");new AjaxDiscussionHandler().getShortenUrl(window.location)};this.showGeneratePasswordPopup=function(){$("#"+popupGeneratePasswordId).modal("show");$("#"+popupGeneratePasswordCloseButtonId).click(function(){$("#"+popupGeneratePasswordId).modal("hide")});$("#"+popupLoginCloseButton).click(function(){$("#"+popupGeneratePasswordId).modal("hide")})};this.showEditFieldsInEditPopup=function(){$("#"+popupEditStatementSubmitButtonId).fadeIn("slow");$("#"+popupEditStatementTextareaId).fadeIn("slow");$("#"+popupEditStatementDescriptionId).fadeIn("slow")};this.showAddTopicPopup=function(c){$("#popup-add-topic").modal("show");$("#popup-add-topic-accept-btn").click(function(){var d=$("#popup-add-topic-info-input").val(),f=$("#popup-add-topic-title-input").val(),e=$("#popup-add-topic-lang-input").find('input[type="radio"]:checked').attr("id");new AjaxDiscussionHandler().sendNewIssue(d,f,e,c)});$("#popup-add-topic-refuse-btn").click(function(){$("#popup-add-topic").modal("hide")})};this.showEditIssuesPopup=function(){var i,d,e,c,g,j,h=new Helper(),f=[];$("#"+popupEditIssueId).modal("show");$("#"+popupEditIssueWarning).hide();i=$("<table>").attr("class","table table-condensed table-hover").attr("border","0").attr("style","border-collapse: separate; border-spacing: 5px 5px;");c=$("<td>").html("<strong>"+_t_discussion(text)+"</strong>").css("text-align","center");g=$("<td>").html("<strong>"+_t_discussion(text)+"</strong>").css("text-align","center");j=$("<td>").html("<strong>"+_t_discussion(options)+"</strong>").css("text-align","right");d.append(c);e.append((g).append(j));i.append((d).append(e));$("#"+popupEditIssueContentId).empty().append(i);$("#"+popupEditTitleTextareaId).hide();$("#"+popupEditTitleDescriptionId).hide();$("#"+popupEditInfoTextareaId).hide();$("#"+popupEditInfoDescriptionId).hide();$("#"+popupEditIssueSubmitButtonId).hide();$("#"+proposalEditListGroupId).empty()};this.showStatementCorrectionsInPopup=function(c){var d,f;d=$("<table>");d.attr("id","edit_statement_table").attr("class","table table-condensed").attr("border","0").attr("style","border-collapse: separate; border-spacing: 5px 5px;");f=$("<tr>");f.append($("<td>").html("<strong>"+_t(date)+"</strong>").css("text-align","center"));f.append($("<td>").html("<strong>"+_t(text)+"</strong>").css("text-align","center"));f.append($("<td>").html("<strong>"+_t(author)+"</strong>").css("text-align","center"));d.append(f);$.each(c.content,function e(g,h){f=$("<tr>").append($("<td>").text(h.date)).append($("<td>").text(h.text)).append($("<td>").append($("<a>").attr("target","_blank").attr("href",h.author_url).text(h.author)).append($("<img>").attr("src",h.author_gravatar)));d.append(f)});$("#"+popupEditStatementLogfileSpaceId).empty().append(d)};this.showHowToWriteTextPopup=function(){var d="HOW_TO_WRITE_TEXT",c=new Helper().isCookieSet(d);if(!c){$("#"+popupHowToWriteText).modal("show")}$("#"+popupHowToWriteTextOkayButton).click(function(){$("#"+popupHowToWriteText).modal("hide");new Helper().setCookie(d)})};this.hideEditFieldsInEditPopup=function(){$("#"+popupEditStatementSubmitButtonId).hide();$("#"+popupEditStatementTextareaId).hide();$("#"+popupEditStatementDescriptionId).hide()};this.hideLogfileInEditPopup=function(){$("#"+popupEditStatementLogfileSpaceId).empty();$("#"+popupEditStatementLogfileHeaderId).html("")};this.hideandClearEditStatementsPopup=function(){$("#"+popupEditStatementId).modal("hide");$("#"+popupEditStatementContentId).empty();$("#"+popupEditStatementLogfileSpaceId).text("");$("#"+popupEditStatementLogfileHeaderId).text("");$("#"+popupEditStatementTextareaId).text("");$("#"+popupEditStatementErrorDescriptionId).text("");$("#"+popupEditStatementSuccessDescriptionId).text("")};this.hideAndClearUrlSharingPopup=function(){$("#"+popupUrlSharingId).modal("hide");$("#"+popupUrlSharingInputId).val("")};this.hideErrorDescription=function(){$("#"+discussionErrorDescriptionId).html("");$("#"+discussionErrorDescriptionSpaceId).hide()};this.hideSuccessDescription=function(){$("#"+discussionSuccessDescriptionId).html("");$("#"+discussionSuccessDescriptionSpaceId).hide()};this.updateOfStatementInDiscussion=function(c){$("#td_"+c.uid).text(c.text);$("#"+c.uid).text(c.text)};this.resetChangeDisplayStyleBox=function(){this.setDisplayStyleAsDiscussion()};this.resetEditAndRefactorButton=function(f){if(typeof f==="undefined"){f=true}var h=false,e,c,g,d;$("#"+discussionSpaceId+" ul > li").children().each(function(){e=$(this).val();c=$(this).attr("id");g=$(this).hasClass("premise");d=$(this).hasClass("start");if(f){if($(this).prop("tagName").toLowerCase().indexOf("input")>-1&&e.length>0&&$.isNumeric(c)||g||d){h=true;return false}}});if(h){$("#"+editStatementButtonId).show();$("#"+reportButtonId).show()}else{$("#"+editStatementButtonId).hide();$("#"+reportButtonId).hide()}};this.getAlertIntoDialogNoDecisions=function(){var e,c,d;e=$("<div>").attr("class","alert alert-dismissible alert-info");c=$("<strong>").text("Ohh...! ");d=$("<span>").text(_t_discussion(noDecisionstaken));e.append(c).append(d);return e}};function Helper(){this.cutTextOnChar=function(f,e,c){var b,d,a;b=1;a=f.length;while(b*e<a){d=f.indexOf(c,b*e);f=f.substr(0,d)+"<br>"+f.substr(d+c.length);b=b+1}return f};this.swapElements=function(d,c){var a=$(c).clone(true),b=$(d).clone(true);$(c).replaceWith(b);$(d).replaceWith(a)};this.getTodayAsDate=function(){var c=new Date(),b=c.getMonth()+1,a=c.getDate();return((a<10?"0":"")+a+"."+(b<10?"0":"")+b+"."+c.getFullYear())};this.escapeHtml=function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b.innerHTML};this.getFullHtmlTextOf=function(a){return $("<div>").append(a).html()};this.startWithLowerCase=function(a){return a.substr(0,1).toLowerCase()+a.substr(1)};this.startWithUpperCase=function(a){return a.substr(0,1).toLocaleUpperCase()+a.substr(1)};this.createRowInEditDialog=function(l,i,g){var b,k,h=new GuiHandler(),n=new AjaxDiscussionHandler(),j,c,e,d;j=$("<tr>");c=$("<td>").text(l).attr("id","td_"+g).attr("for",i);e=$("<td>").css("text-align","right");b=$("<input>").css("margin","2px").attr("type","button").attr("value",_t_discussion(edit)).attr("class","btn btn-primary btn-xs").click(function m(){$("#"+popupEditStatementTextareaId).text($(this).parent().prev().text());$("#"+popupEditStatementContentId+" td").removeClass("text-hover");$(this).parent().prev().addClass("text-hover");$("#"+popupEditStatementErrorDescriptionId).text("");$("#"+popupEditStatementSuccessDescriptionId).text("");h.showEditFieldsInEditPopup();h.hideLogfileInEditPopup();$("#"+popupEditStatementSubmitButtonId).click(function o(){d=$("#"+popupEditStatementContentId+" .text-hover");new AjaxDiscussionHandler().sendCorrectureOfStatement(d.attr("id").substr(3),$("#"+popupEditStatementTextareaId).val(),d)})}).hover(function f(){$(this).toggleClass("btn-primary",400)});k=$("<input>").css("margin","2px").attr("type","button").attr("value",_t_discussion(changelog)).attr("class","btn btn-primary btn-xs").click(function a(){$("#"+popupEditStatementLogfileHeaderId).html(_t(logfile)+": <strong>"+$(this).parent().prev().text()+"</strong>");$("#"+popupEditStatementErrorDescriptionId).text("");$("#"+popupEditStatementSuccessDescriptionId).text("");$("#"+popupEditStatementContentId+" td").removeClass("text-hover");$(this).parent().prev().addClass("text-hover");n.getLogfileForStatement($(this).parent().prev().attr("id").substr(3));h.hideEditFieldsInEditPopup()}).hover(function f(){$(this).toggleClass("btn-primary",400)});e.append(b);e.append(k);j.append(c);j.append(e);return j};this.getCurrentIssueId=function(){return $("#"+issueDropdownButtonID).attr("issue")};this.setCookie=function(a){this.setCookieForDays(a,7)};this.setCookieForDays=function(c,g,f){var e=new Date();var b=g*24*60*60*1000;e.setTime(e.getTime()+b);var a="expires="+e.toGMTString();document.cookie=c+"="+f+"; "+a+";path=/";$(document).trigger("user_cookie_consent_changed",{consent:f})};this.isCookieSet=function(e){var d=document.cookie.split(";"),a=false;for(var b=0;b<d.length;b++){var f=d[b].trim();if(f.indexOf(e)==0){a=f.substring(e.length+1,f.length)}}return a};this.redirectInNewTabForContact=function(e){var a=$("#"+hiddenCSRFTokenId).val();var c='<input type="hidden" name="csrf_token" value="'+a+'">';var d=$("<form target='_blank' method='POST' style='display:none;'>"+c+"</form>").attr("action",mainpage+"contact");d.appendTo(document.body);for(var b in e){if(e.hasOwnProperty(b)){d.append($('<input type="hidden" />').attr("name",b).attr("value",e[b]))}}d.submit().remove()};this.getMaxSizeOfGraphViewContainer=function(){var c,b,a;c=$("#"+customBootstrapMenuId);b=$("#footer");a=window.innerHeight;a-=c.outerHeight(true);a-=b.outerHeight(true);a-=this.getPaddingOfElement(c);a-=this.getPaddingOfElement(b);return a};this.getMaxSizeOfDiscussionViewContainer=function(){var a,c,b;a=$("#header-container");b=$("#"+discussionSpaceListId);c=this.getMaxSizeOfGraphViewContainer();c-=a.outerHeight(true);c-=b.outerHeight(true);c-=this.getPaddingOfElement(a);c-=this.getPaddingOfElement(b);return c-10};this.getPaddingOfElement=function(a){return parseInt(a.css("padding-top").replace("px",""))+parseInt(a.css("padding-bottom").replace("px",""))};this.isMobileAgent=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};this.setLocalStorage=function(a,c){try{localStorage.setItem(a,c);return true}catch(b){console.log("Error while set item in local storage.");return false}};this.getLocalStorage=function(a){try{return localStorage.getItem(a)}catch(b){console.log("Error while get item in local storage.");return undefined}};this.rotateElement=function(a,b){a.css("-ms-transform","rotate("+b+"deg)").css("-webkit-transform","rotate("+b+"deg)").css("transform","rotate("+b+"deg)")};this.setAnimationSpeed=function(a,b){a.css("-webkit-transition","all "+b+"s ease").css("-moz-transition","all "+b+"s ease").css("-o-transition","all "+b+"s ease").css("transition","all "+b+"s ease")};this.delay=function(){var a=0;return function(c,b){clearTimeout(a);a=setTimeout(c,b)}}()};function InteractionHandler(){this.callbackIfDoneForSendNewStartStatement=function(a){var b=$.parseJSON(a);if(b.error.length>0){$("#"+addStatementErrorContainer).show();$("#"+addStatementErrorMsg).text(b.error)}else{$("#"+discussionSpaceId+"input:last-child").attr("checked",false).prop("checked",false);window.location.href=b.url}};this.callbackIfDoneForSendNewPremisesArgument=function(a){var b=$.parseJSON(a);if(b.error.length>0){$("#"+addPremiseErrorContainer).show();$("#"+addPremiseErrorMsg).text(b.error)}else{window.location.href=b.url}};this.callbackIfDoneForSendNewStartPremise=function(a){var b=$.parseJSON(a);if(b.error.length>0){$("#"+addPremiseErrorContainer).show();$("#"+addPremiseErrorMsg).text(b.error)}else{window.location.href=b.url}};this.callbackIfDoneForGettingLogfile=function(a){var b=$.parseJSON(a);if(b.error.length==0){$("#"+popupEditStatementLogfileSpaceId).text("");new GuiHandler().showStatementCorrectionsInPopup(b)}else{$("#"+popupEditStatementLogfileSpaceId).text(b.error)}};this.callbackIfDoneForSendCorrectureOfStatement=function(b,a){var c=$.parseJSON(b);if(c.error.length!=0){$("#"+popupEditStatementErrorDescriptionId).text(c.error)}else{new GuiHandler().updateOfStatementInDiscussion(c,a);$("#"+popupEditStatementErrorDescriptionId).text("");$("#"+popupEditStatementSuccessDescriptionId).text(_t(correctionsSet))}};this.callbackIfDoneForShortenUrl=function(c,b){var d=$.parseJSON(c),a;if(d.error.length==0){a='<a href="'+d.service_url+'" title="'+d.service+'" target="_blank">'+d.service+"</a>";$("#"+popupUrlSharingDescriptionPId).html(_t_discussion(feelFreeToShareUrl)+", "+_t_discussion(shortenedBy)+" "+a+":");$("#"+popupUrlSharingInputId).val(d.url).data("short-url",d.url)}else{$("#"+popupUrlSharingDescriptionPId).text(_t_discussion(feelFreeToShareUrl)+".");$("#"+popupUrlSharingInputId).val(b)}};this.callbackIfDoneFuzzySearch=function(c,b,a){var d=$.parseJSON(c);if(Object.keys(d).length==0){$("#"+proposalStatementListGroupId).empty();$("#"+proposalPremiseListGroupId).empty();$("#"+proposalEditListGroupId).empty();$("#"+proposalUserListGroupId).empty()}else{new GuiHandler().setStatementsAsProposal(d,b,a)}};this.callbackIfDoneForGettingInfosAboutArgument=function(c){var m=$.parseJSON(c),l,d;if(m.error.length==0){var f=$("<div>"),n=$("<table>").attr("class","table table-condensed table-hover").attr("border","0").attr("style","border-collapse: separate; border-spacing: 5px 5px;"),j=$("<tr>").append($("<td>").html("<strong>"+_t_discussion(avatar)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(nickname)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(avatar)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(nickname)+"</strong>").css("text-align","left")),e=$("<tbody>"),b,g,k="",h="",a=0;if(Object.keys(m.supporter).length>1){j.append($("<td>").html("<strong>"+_t_discussion(avatar)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(nickname)+"</strong>").css("text-align","left"))}l=m.text+"<br><br>";l+=_t_discussion(messageInfoStatementCreatedBy)+" "+m.author+", ";l+=m.timestamp+".<br>";l+=_t_discussion(messageInfoCurrentlySupported)+" "+m.vote_count+" ";l+=_t_discussion(messageInfoParticipant)+(m.vote_count==1?"":_t_discussion(messageInfoParticipantPl))+".";if(m.vote_count>0){$.each(m.supporter,function(o,i){b=$("<td>").append($("<a>").attr("target","_blank").attr("href",m.public_page[i]).text(i));g=$("<td>").html('<img class="preload-image" style="height: 40%;" src="'+m.gravatars[i]+'"></td>');if(a==1){a=0;e.append($("<tr>").append(h).append(k).append(g).append(b))}else{a=1;k=b;h=g}});if(a==1){e.append($("<tr>").append(h).append(k))}}if(e.find("tr").length==0){f.append(new GuiHandler().getAlertIntoDialogNoDecisions())}else{f.append(n.append(e))}f.append(l).append(n.append(e));displayConfirmationDialogWithoutCancelAndFunction(_t_discussion(messageInfoTitle),f);$("#"+popupConfirmDialogId).find(".modal-dialog");new Helper().delay(function(){var i=$("#"+popupConfirmDialogId).find(".modal-body div");if($(window).height()>400&&i.outerHeight(true)>$(window).height()){i.slimScroll({position:"right",railVisible:true,alwaysVisible:true,height:($(window).height()/3*2)+"px"})}},300)}else{l=m.error;d=$("<p>").html(l);displayConfirmationDialogWithoutCancelAndFunction(_t_discussion(messageInfoTitle),d)}};this.callbackIfDoneForSendNewIssue=function(f){var h=$.parseJSON(f);if(h.error.length==0){$("#popup-add-topic").modal("hide");var b=$("<li>").addClass("enabled"),c=$("<a>").attr("href",h.issue.url).attr("value",h.issue.title),d=$("<span>").text(h.issue.title),g=$("<span>").addClass("badge").attr("style","float: right; margin-left: 1em;").text(h.issue.arg_count),e=$("#"+issueDropdownListID).find("li.divider");b.append(c.append(d).append(g));if(e.length>0){b.insertBefore(e)}}else{$("#popup-add-topic-error-text").text(h.error);$("#popup-add-topic-error").show();new Helper().delay(function(){$("#popup-add-topic-error").hide()},2500)}};this.callbackIfDoneForSendNewIssueTable=function(c){var d=$.parseJSON(c);if(d.error.length==0){$("#popup-add-topic").modal("hide");var b=$("#issue-table");var a=$("<tr>").append($("<td>").html(d.issue.uid)).append($("<td>").html(d.issue.title)).append($("<td>").html(d.issue.info)).append($("<td>").html(d.issue.date)).append($("<td>").append($("<a>").attr("target","_blank").attr("href",d.issue.public_url).text(d.issue.author))).append($("<td>").append($("<a>").attr("href","#").attr("class","btn btn-info btn-lg").append($("<span>").attr("class","glyphicon glyphicon-edit"))));b.append(a)}else{$("#popup-add-topic-error-text").text(d.error);$("#popup-add-topic-error").show();new Helper().delay(function(){$("#popup-add-topic-error").hide()},2500)}};this.callbackIfDoneForGettingMoreInfosAboutOpinion=function(d,l){var o=$.parseJSON(d),n,h;if(o.error.length==0){var e=$("<div>"),m=l?$("<span>").text(o.opinions.message):$("<span>").text(o.opinions[0].message),p=$("<table>").attr("class","table table-condensed table-hover").attr("border","0").attr("style","border-collapse: separate; border-spacing: 5px 5px;"),i=$("<tr>").append($("<td>").html("<strong>"+_t_discussion(avatar)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(nickname)+"</strong>").css("text-align","left")),c=$("<tbody>"),b,f,k="",g="",a=0;n=l?o.opinions.users:o.opinions[0].users;if(Object.keys(n).length>1){i.append($("<td>").html("<strong>"+_t_discussion(avatar)+"</strong>").css("text-align","left")).append($("<td>").html("<strong>"+_t_discussion(nickname)+"</strong>").css("text-align","left"))}p.append($("<thead>").append(i));$.each(n,function(j,q){b=$("<td>").append($("<a>").attr("target","_blank").attr("href",q.public_profile_url).text(q.nickname));f=$("<td>").html('<img class="preload-image" style="height: 40%;" src="'+q.avatar_url+'"></td>');if(a==1){a=0;c.append($("<tr>").append(g).append(k).append(f).append(b))}else{a=1;k=b;g=f}});if(a==1){c.append($("<tr>").append(g).append(k))}if(c.find("tr").length==0){e.append(new GuiHandler().getAlertIntoDialogNoDecisions())}else{e.append(m).append(p.append(c))}displayConfirmationDialogWithoutCancelAndFunction(_t_discussion(usersWithSameOpinion),e);$("#"+popupConfirmDialogId).find(".modal-dialog");new Helper().delay(function(){h=$("#"+popupConfirmDialogId).find(".modal-body div");if($(window).height()>400&&h.outerHeight(true)>$(window).height()){h.slimScroll({position:"right",railVisible:true,alwaysVisible:true,height:($(window).height()/3*2)+"px"})}},300)}else{setGlobalErrorHandler(_t(ohsnap),o.error)}};this.sendStatement=function(l,a,h,m,b,f){if(l.length==0){if(f==fuzzy_start_statement){$("#"+addStatementErrorContainer).show();$("#"+addStatementErrorMsg).text(_t(inputEmpty))}else{$("#"+addPremiseErrorContainer).show();$("#"+addPremiseErrorMsg).text(_t(inputEmpty))}}else{var k=[],g=[];if($.isArray(l)){for(var e=0;e<l.length;e++){l[e]=l[e].replace(/\s\s+/g," ");while(l[e].indexOf((_t_discussion(and)+" "),l[e].length-(_t_discussion(and)+" ").length)!==-1||l[e].indexOf((_t_discussion(and)),l[e].length-(_t_discussion(and)).length)!==-1){if(l[e].indexOf((_t_discussion(and)+" "),l[e].length-(_t_discussion(and)+" ").length)!==-1){l[e]=l[e].substr(0,l[e].length-(_t_discussion(and)+" ").length)}else{l[e]=l[e].substr(0,l[e].length-(_t_discussion(and)).length)}}while(l[e].indexOf((" "),l[e].length-(" ").length)!==-1){l[e]=l[e].substr(0,l[e].length-(" ").length)}if(l[e].toLocaleLowerCase().indexOf(" "+_t_discussion(and)+" ")!=-1){k.push(l[e])}else{g.push(l[e])}}}if(k.length>0){var c=new Helper();for(var d=0;d<k.length;d++){k[d]=c.startWithLowerCase(k[d]);if(k[d].match(/\.$/)){k[d]=k[d].substr(0,k[d].length-1)}}new GuiHandler().showSetStatementContainer(k,g,h,f,m,b,a)}else{if(f==fuzzy_start_statement){if(g.length>0){alert("TODO: more than one decided text")}else{new AjaxDiscussionHandler().sendNewStartStatement(l)}}else{if(f==fuzzy_start_premise){new AjaxDiscussionHandler().sendNewStartPremise(l,a,h)}else{if(f==fuzzy_add_reason){new AjaxDiscussionHandler().sendNewPremiseForArgument(m,b,l)}}}}}}};"use strict";function Main(){this.setClickFunctions=function(s,g){$(".icon-add-premise").each(function(){$(this).click(function(){s.appendAddPremiseRow($(this));$(this).hide().prev().show();$("#"+sendNewPremiseId).val(_t(saveMyStatements))})});$("#"+b).click(function b(){if($(this).val()===_t(showAllUsers)){g.getUsersOverview();$(this).val(_t(hideAllUsers))}else{$("#"+adminsSpaceForUsersId).empty();$(this).val(_t(showAllUsers))}});$("#"+listAllArgumentId).click(function e(){if($(this).val()===_t(showAllAttacks)){g.getArgumentOverview()}else{$("#"+adminsSpaceForArgumentsId).empty()}});$("#"+f).click(function f(){$("#"+addStatementContainerId).hide();$("#"+addStatementErrorContainer).hide();$("#"+discussionSpaceId+" li:last-child input").attr("checked",false).prop("checked",false).enable=true});$("#"+closePremiseContainerId).click(function f(){$("#"+addPremiseContainerId).hide();$("#"+addPremiseErrorContainer).hide();$("#"+discussionSpaceId+" li:last-child input").attr("checked",false).prop("checked",false).enable=true});$("#"+closeIslandViewContainerId).click(function(){s.resetChangeDisplayStyleBox();$("#li_"+addReasonButtonId).attr("checked",true).prop("checked",true)});$("#"+closeGraphViewContainerId).click(function(){s.resetChangeDisplayStyleBox()});$("#"+editStatementButtonId).click(function(){s.showEditStatementsPopup()});$("#"+o).click(function o(){s.hideandClearEditStatementsPopup()});$("#"+c).click(function c(){s.hideandClearEditStatementsPopup()});$("#"+d).click(function d(){s.hideAndClearUrlSharingPopup()});$("#"+p).click(function p(){s.hideAndClearUrlSharingPopup()});$("#"+shareUrlId).click(function j(){s.showUrlSharingPopup()});$("#"+popupUrlSharingLongUrlButtonID).click(function(){var t=$("#"+popupUrlSharingInputId);if($(this).data("is-short-url")=="0"){t.val(t.data("short-url"));$(this).data("is-short-url","1").text(_t_discussion(fetchLongUrl))}else{t.val(window.location);$(this).data("is-short-url","0").text(_t_discussion(fetchShortUrl))}});$("#"+m).click(function m(){new Sharing().emailShare("user@example.com",_t(interestingOnDBAS),_t(haveALookAt)+" "+$("#"+popupUrlSharingInputId).val())});$("#"+i).click(function i(){new Sharing().twitterShare($("#"+popupUrlSharingInputId).val(),"")});$("#"+h).click(function h(){new Sharing().googlePlusShare($("#"+popupUrlSharingInputId).val())});$("#"+k).click(function k(){var t=$("#"+popupUrlSharingInputId).val();new Sharing().facebookShare(t,"FB Sharing",_t(haveALookAt)+" "+t,mainpage+"static/images/logo.png")});s.setDisplayStyleAsDiscussion();$("#"+displayStyleIconGuidedId).click(function a(){s.setDisplayStyleAsDiscussion()});$("#"+displayStyleIconIslandId).click(function r(){s.setDisplayStyleAsIsland()});$("#"+displayStyleIconExpertId).click(function n(){s.setDisplayStyleAsGraphView()});$("#"+reportButtonId).click(function q(){var u="Report "+new Helper().getTodayAsDate(),t="URL: "+window.location.href,w=_t(fillLine).toUpperCase(),v={content:u+"\n"+t+"\n"+w,name:$("#header_user").parent().text().replace(/\s/g,"")};new Helper().redirectInNewTabForContact(v)});$("#"+opinionBarometerImageId).show().click(function l(){new DiscussionBarometer().showBarometer()});$("#"+issueDropdownListID+" .enabled").each(function(){if($(this).children().length>0){$(this).children().click(function(){var t=$(this).attr("href"),u=_t(switchDiscussionText1)+" <strong>"+$(this).attr("value")+"</strong> ";u+=_t(switchDiscussionText2);u+="<br><br>";u+=_t(switchDiscussionText3);$(this).attr("href","#");displayConfirmationDialogWithCheckbox(_t(switchDiscussion),u,_t.keepSetting,t,true)})}});$("#"+issueDropdownListID+" .disabled a").off("click").unbind("click");$(".triangle-l").click(function(){if($(this).attr("id").indexOf(questionBubbleId)!=-1){var t=$(this).attr("id").replace(questionBubbleId+"-","");g.getMoreInfosAboutArgument(t,true)}});$("#"+addTopicButtonId).click(function(){s.showAddTopicPopup(new InteractionHandler().callbackIfDoneForSendNewIssue)});$(".triangle-r-info").each(function(){if($(this).data("votecount")>0){$(this).click(function(){var v=$(this).data("type"),t=$(this).data("argument-uid"),u=$(this).data("statement-uid"),w=$(this).data("is-supportive");new AjaxDiscussionHandler().getMoreInfosAboutOpinion(v,t,u,w)})}else{$(this).removeClass("triangle-r-info").addClass("triangle-r-info-nohover")}});$("#"+contactSubmitButtonId).click(function(){setTimeout("$('body').addClass('loading')",0)})};this.setSidebarClicks=function(h,i){var d=new Helper();var f=h.find("."+sidebarWrapperClass);var b=h.find("."+contentWrapperClass);var c=f.find("."+hamburgerIconClass);var e=f.find("."+sidebarTackWrapperClass);var g=f.find("."+sidebarTackClass);var a=f.find("."+sidebarClass);$(c).click(function(){$(this).toggleClass("open");var j=b.width();if(a.is(":visible")){e.fadeOut();a.toggle("slide");c.css("margin-right","0.5em").css("background-color","");h.css("max-height","");f.css("background-color","").css("height","");d.delay(function(){b.width(j+a.outerWidth())},300);d.setLocalStorage(i,"false")}else{b.width(j-a.outerWidth());h.css("max-height",h.outerHeight()+"px");d.delay(function(){a.toggle("slide");c.css("margin-right",(f.width()-c.width())/2+"px").css("margin-left","auto").css("background-color",a.css("background-color"));f.css("background-color",$("#"+discussionBubbleSpaceId).css("background-color")).css("height",h.outerHeight()+"px");e.fadeIn()},200)}});e.click(function(){var j=d.getLocalStorage(i)=="true";if(j){d.rotateElement(g,"0");d.setLocalStorage(i,"false");g.data("title",_t_discussion(pinNavigation));if(a.is(":visible")){c.click()}}else{d.rotateElement(g,"90");d.setLocalStorage(i,"true");g.data("title",_t_discussion(unpinNavigation))}})};this.setSidebarStyle=function(j,k){var i=new Helper().getLocalStorage(k)=="true";var g=j.find("."+sidebarWrapperClass);var b=j.find("."+contentWrapperClass);var f=g.find("."+sidebarTackWrapperClass);var h=g.find("."+sidebarTackClass);var a=g.find("."+sidebarClass);var e=new Helper();if(i){var d=b.width();var c=g.find("."+hamburgerIconClass);e.rotateElement(h,"90");e.setAnimationSpeed(b,"0.0");e.setAnimationSpeed(c,"0.0");c.addClass("open");b.width(d-a.outerWidth());j.css("max-height",j.outerHeight()+"px");a.show();c.css("margin-right",(g.width()-c.width())/2+"px").css("margin-left","auto").css("background-color",a.css("background-color"));g.css("background-color",$("#"+discussionBubbleSpaceId).css("background-color")).css("height",j.outerHeight()+"px");f.fadeIn();e.setAnimationSpeed(b,"0.5");e.setAnimationSpeed(c,"0.5");f.data("title",_t_discussion(unpinNavigation))}else{f.data("title",_t_discussion(pinNavigation))}};this.setKeyUpFunctions=function(a,b){$("#"+addStatementContainerMainInputId).keyup(function(){new Helper().delay(function(){var d=new Helper().escapeHtml($("#"+addStatementContainerMainInputId).val());if($("#"+discussionBubbleSpaceId).find("p:last-child").text().indexOf(_t(initialPositionInterest))!=-1){b.fuzzySearch(d,addStatementContainerMainInputId,fuzzy_start_statement,"")}else{b.fuzzySearch(d,addStatementContainerMainInputId,fuzzy_start_premise,"")}},200);setTextWatcherForMaxLength($(this))}).focusin(function(){setTextWatcherForMaxLength($(this))});$("#"+addPremiseContainerMainInputId).keyup(function(){new Helper().delay(function(){var d=new Helper().escapeHtml($("#"+addPremiseContainerMainInputId).val());b.fuzzySearch(d,addPremiseContainerMainInputId,fuzzy_add_reason,"")},200);setTextWatcherForMaxLength($(this))}).focusin(function(){setTextWatcherForMaxLength($(this))});$("#"+popupEditStatementTextareaId).keyup(function c(){new Helper().delay(function(){b.fuzzySearch($("#"+popupEditStatementTextareaId).val(),popupEditStatementTextareaId,fuzzy_statement_popup,$("#"+popupEditStatementContentId+" .text-hover").attr("id").substr(3));$("#"+popupEditStatementWarning).hide();$("#"+popupEditStatementWarningMessage).text("")},200);setTextWatcherForMaxLength($(this))}).focusin(function(){setTextWatcherForMaxLength($(this))})};this.setStyleOptions=function(a){a.setMaxHeightForBubbleSpace();a.hideSuccessDescription();a.hideErrorDescription();$("#"+popupUrlSharingInputId).on("click",function(){$(this).select()});var c="data-argumentation-type";var b=$("#"+discussionSpaceListId);b.find("span["+c+'!=""]').each(function(){var d=$(this).attr(c);var e=$("<span>").addClass(d+"-highlighter");e.appendTo(document.body);var f=$(this).css("color");var g=e.css("color");e.remove();$(this).hover(function(){$("#dialog-speech-bubbles-space").find("span["+c+'="'+d+'"]').css("color",g).css("background-color","#edf3e6").css("border-radius","2px")},function(){$("#dialog-speech-bubbles-space").find("span["+c+'="'+d+'"]').css("color",f).css("background-color","").css("border-radius","0")})});b.children().each(function(){$(this).hover(function(){$(this).find("input").prop("checked",true)},function(){$(this).find("input").prop("checked",false)})})};this.setWindowOptions=function(){$(document).on({ajaxStart:function b(){setTimeout("$('body').addClass('loading')",0)},ajaxStop:function c(){setTimeout("$('body').removeClass('loading')",0)}});$("#navbar-left").empty();$(window).load(function a(){});$(window).resize(function(){new GuiHandler().setMaxHeightForBubbleSpace()})};this.setGuiOptions=function(){if(false&&window.location.href.indexOf("/reaction/")!=-1){var n="icon-badge",b="height: 30px; width:30px; margin-right: 0.5em;",a=mainpage+"static/images/icon_discussion_",q=$("#item_undermine"),p=$("#item_support"),c=$("#item_undercut"),g=$("#item_overbid"),m=$("#item_rebut"),k=$("#item_no_opinion"),o=$("<img>").addClass(n).attr({style:b,src:a+"undermine.png",onclick:q.attr("onclick")}),l=$("<img>").addClass(n).attr({style:b,src:a+"support.png",onclick:p.attr("onclick")}),i=$("<img>").addClass(n).attr({style:b,src:a+"undercut.png",onclick:c.attr("onclick")}),f=$("<img>").addClass(n).attr({style:b,src:a+"overbid.png",onclick:g.attr("onclick")}),e=$("<img>").addClass(n).attr({style:b,src:a+"rebut.png",onclick:m.attr("onclick")}),h=$("<img>").addClass(n).attr({style:b,src:a+"no_opinion.png",onclick:k.attr("onclick")});q.hide().next().prepend(o);p.hide().next().prepend(l);c.hide().next().prepend(i);g.hide().next().prepend(f);m.hide().next().prepend(e);k.hide().next().prepend(h)}$("#"+popupLogin).on("hidden.bs.modal",function(){var r=$("#"+discussionSpaceListId).find("#item_login");if(r.length>0){r.attr("checked",false).prop("checked",false)}}).on("shown.bs.modal",function(){$("#"+loginUserId).focus()});var j=window.location.href.indexOf("edited_statement=");if(j!=-1){var d=window.location.href.substr(j+"edited_statement=".length);$("#"+d).css("background-color","#FFF9C4")}};this.setInputExtraOptions=function(h,e){var j=$("#"+discussionSpaceListId);var k=j.find("li:last-child input");var m=[],l,c,i,n,b;l=window.location.href.split("?");l=l[0].split("/");var a=function(){m=$("#"+addStatementContainerMainInputId).val();e.sendStatement(m,"","","","",fuzzy_start_statement)};var f=function(){c=l[l.length-2];i=l[l.length-1]=="t";m=[];$("#"+addPremiseContainerBodyId+" input").each(function(){if($(this).val().length>0){m.push($(this).val())}});e.sendStatement(m,c,i,"","",fuzzy_start_premise)};var g=function(){m=[];$("#"+addPremiseContainerBodyId+" input").each(function(){if($(this).val().length>0){m.push($(this).val())}});var o=window.location.href.indexOf("support")!=-1?1:0;n=l[l.length-3-o];i=l[l.length-2-o]=="t";b=l[l.length-1-o];e.sendStatement(m,"",i,n,b,fuzzy_add_reason)};if(window.location.href.indexOf("/r/")!=-1){$("#"+discussionSpaceId+" label").each(function(){$(this).css("width","95%")})}$("#"+discussionSpaceId+" input").each(function(){$(this).attr("checked",false).prop("checked",false)});$("#"+sendNewStatementId).off("click").click(function(){if($(this).attr("name").indexOf("start")!=-1){a()}});$("#"+sendNewPremiseId).off("click").click(function(){if(k.attr("id").indexOf("start_statement")!=-1){a()}else{if(k.attr("id").indexOf("start_premise")!=-1){f()}else{if(k.attr("id").indexOf("justify_premise")!=-1){g()}}}});var d=j.find("input");if(d.length==1&&(d.eq(0).attr("id").indexOf("start_statement")!=-1||d.eq(0).attr("id").indexOf("start_premise")!=-1||d.eq(0).attr("id").indexOf("justify_premise")!=-1||(d.eq(0).attr("id").indexOf("login")!=-1)&&$("#link_popup_login").text().trim().indexOf(_t(login))==-1)){d.eq(0).attr("checked",true).prop("checked",true).parent().hide()}if(k.attr("id")&&(k.attr("id").indexOf("start_statement")!=-1||k.attr("id").indexOf("start_premise")!=-1||k.attr("id").indexOf("justify_premise")!=-1||k.attr("id").indexOf("login")!=-1)){k.attr("onclick","");k.change(function(){if(k.prop("checked")){if(k.attr("id").indexOf("start_statement")!=-1){h.showAddPositionContainer();$("#"+sendNewStatementId).off("click").click(function(){a()})}else{if(k.attr("id").indexOf("start_premise")!=-1){h.showAddPremiseContainer();$("#"+sendNewPremiseId).off("click").click(function(){f()})}else{if(k.attr("id").indexOf("justify_premise")!=-1){h.showAddPremiseContainer();$("#"+sendNewPremiseId).off("click").click(function(){g()})}else{if(k.attr("id").indexOf("login")!=-1){$("#"+popupLogin).modal("show")}}}}}})}}}$(document).ready(function mainDocumentReady(){var g="tacked_sidebar";var b=new GuiHandler();var d=new AjaxDiscussionHandler();var e=new InteractionHandler();var a=new Main();var f;var c=$("#"+discussionContainerId);b.setHandler(e);a.setStyleOptions(b);a.setSidebarStyle(c,g);a.setSidebarClicks(c,g);a.setClickFunctions(b,d);a.setKeyUpFunctions(b,d);a.setWindowOptions();a.setGuiOptions();a.setInputExtraOptions(b,e);f=$("#discussion-restart-btn").attr("onclick").substr("location.href=".length);f=f.substr(1,f.length-2);$("#"+discussionEndRestart).attr("href",f);f=window.location.href.split("?");if(f[0].indexOf("/reaction/")!=-1){$("#island-view-undermine-button").attr("onclick",$("#item_undermine").attr("onclick"));$("#island-view-support-button").attr("onclick",$("#item_support").attr("onclick"));$("#island-view-undercut-button").attr("onclick",$("#item_undercut").attr("onclick"));$("#island-view-rebut-button").attr("onclick",$("#item_rebut").attr("onclick"))}$(document).delegate(".open","click",function(h){$(this).addClass("oppenned");h.stopPropagation()});$(document).delegate("body","click",function(h){$(".open").removeClass("oppenned")});$(document).delegate(".cls","click",function(h){$(".open").removeClass("oppenned");h.stopPropagation()})});