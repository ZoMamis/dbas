

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Development &mdash; D-BAS 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="D-BAS 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="Architecture" href="architecture/index.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="home.html" class="fa fa-home"> D-BAS</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-with-vagrant-virtual-machine">Installation with Vagrant virtual machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-backend">Installation (backend)</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#run-the-application">Run the application</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#run-test-suites">Run test suites</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-remarks">General Remarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-testsuite">Running the Testsuite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generate-html-documentation">Generate html documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-scaffold-for-extension-packages">Create scaffold for extension packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-packages">Update packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adhocracy-releases">Adhocracy Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture/index.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="architecture/frontend_structure.html">Frontend Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture/backend_structure.html">Backend Structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="home.html">D-BAS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="home.html">Docs</a> &raquo;</li>
      
    <li>Development</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/development.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-remarks">
<h2>General Remarks<a class="headerlink" href="#general-remarks" title="Permalink to this headline">¶</a></h2>
<p>Use test driven development and check code style bevore pushing commits
(see <cite>Coding Style Guideline</cite> ).</p>
<p>Manually check pyflake, pep257:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/check_code src/adhocracy src/adhocracy_sample
</pre></div>
</div>
<p>Example Vim config according to coding guideline:</p>
<div class="highlight-python"><div class="highlight"><pre>https://github.com/liqd/vim_config
</pre></div>
</div>
<p>When changing the api, the frontend needs to re-generate the
TypeScript modules providing the resource classes.  This may trigger
compiler errors that have to be resolved manually.  For more details,
see comment in the beginning of mkResources.ts.</p>
</div>
<div class="section" id="running-the-testsuite">
<h2>Running the Testsuite<a class="headerlink" href="#running-the-testsuite" title="Permalink to this headline">¶</a></h2>
<p>frontend unit tests:</p>
<blockquote>
<div><ol class="upperalpha">
<li><p class="first">Integrated with py.test:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/polytester jsunit
</pre></div>
</div>
</li>
<li><p class="first">In browser:</p>
<div class="highlight-python"><div class="highlight"><pre>make -C ./parts/static/js/ compile_tests_browser
xdg-open http://localhost:6551/static/test.html
</pre></div>
</div>
<p>Make sure backend is running (or some means of delivering html
and js to the browser).</p>
<p>This is the best way to develop, as it lets you run tests
indiviually and repeatedly and enter the debugger.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the debugger, it helps to disable the script tag about
blanket in test.html.  You can do this thusly:</p>
<div class="last highlight-python"><div class="highlight"><pre>make -C ./parts/static/js/ compile_tests_browser test-no-blanket
xdg-open http://localhost:6551/static/test-no-blanket.html
</pre></div>
</div>
</div>
</li>
</ol>
</div></blockquote>
<p>frontend integration tests (jsint):</p>
<blockquote>
<div><p>Frontend integration tests behave like unit tests in the sense
that they are driven by jasmine and can access all exports of all
typescript modules; they behave like end-to-end tests in that they
can talk to a running backend, angular runtime, etc..</p>
<p>This makes it possible to write integration tests that reproduce
any possible bug once it is reported (even though it may sometimes
be better to write a unit or an acceptance test).</p>
<p>For instance, one can write
a test that registers and injects the AdhHttp service, renders
some directive into the DOM, sends some keys to some input fields
and clicks &#8220;save&#8221;, and, once the object has been saved to the
database, gets it from the backend and compares it to the one
rendered in the directive.</p>
<p>Integration tests do not support nodejs.  They can only be run in
browser manually or via py.test.</p>
<ol class="upperalpha">
<li><p class="first">Integrated with py.test:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/polytester jsint
</pre></div>
</div>
</li>
<li><p class="first">In browser:</p>
<div class="highlight-python"><div class="highlight"><pre>make -C ./parts/static/js/ compile_tests_browser
xdg-open http://localhost:6551/static/igtest.html
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As with the unit tests (see above), when running
integration tests in the browser manually, you are
responsible for making sure the backend is running.  In
contrast to unit tests, debugging works smoothly without
any tricks, because we don&#8217;t run blanket for test coverage
reporting.</p>
</div>
</li>
</ol>
</div></blockquote>
<p>protractor acceptance tests:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/polytester acceptance
</pre></div>
</div>
<p>run backend functional tests:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/polytester pyfunc
</pre></div>
</div>
<p>run backend unit tests and show python test code coverage:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/polytester pyunit
xdg-open ./htmlcov/index.html
</pre></div>
</div>
<p>run all test:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">bin</span><span class="o">/</span><span class="n">polytester</span>
</pre></div>
</div>
<p>to display console output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">bin</span><span class="o">/</span><span class="n">polytester</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>modify test config:</p>
<blockquote>
<div>tests.ini  (run all tests with polytester)
pytest.ini (python/jasmin tests with pytest)
etc/protractorConf (acceptantance tests with protractor)</div></blockquote>
<p>delete database (works best on development systems without valuable data!):</p>
<div class="highlight-python"><div class="highlight"><pre>rm -f ./var/Data.*
bin/supervisorctl restart adhocracy:*
</pre></div>
</div>
<p>If you are using the <cite>supervisor group adhocracy_test:*</cite>, you don&#8217;t have
to delete anything.  The database is in-memory and will die with the
test_zodb service.</p>
</div>
<div class="section" id="generate-html-documentation">
<h2>Generate html documentation<a class="headerlink" href="#generate-html-documentation" title="Permalink to this headline">¶</a></h2>
<p>Recreate api documentation source files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">bin</span><span class="o">/</span><span class="n">sphinx_api_adhocracy</span>
</pre></div>
</div>
<p>Generate html documentation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">bin</span><span class="o">/</span><span class="n">sphinx_build_adhocracy</span>
</pre></div>
</div>
<p>Open html documentation:</p>
<div class="highlight-python"><div class="highlight"><pre>xdg-open docs/build/html/index.html
</pre></div>
</div>
</div>
<div class="section" id="create-scaffold-for-extension-packages">
<h2>Create scaffold for extension packages<a class="headerlink" href="#create-scaffold-for-extension-packages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>bin/pcreate -s adocracy_extension adhocracy_XX
</pre></div>
</div>
</div>
<div class="section" id="update-packages">
<h2>Update packages<a class="headerlink" href="#update-packages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python">
<h3>python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Check whether new Python versions exist:</p>
<div class="highlight-python"><div class="highlight"><pre>bin/checkversions -v -l 0 versions.cfg | grep was
</pre></div>
</div>
<p>You may then update the pinned Python versions in <cite>versions.cfg</cite> if
appropriate.</p>
</div>
<div class="section" id="ruby">
<h3>ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>bin/gem outdated  # binary may also be called bin/gem1.9.1 or bin/gem2.1
</pre></div>
</div>
</div>
<div class="section" id="node-js">
<h3>node.js<a class="headerlink" href="#node-js" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>bin/npm --prefix node_modules --depth 0 outdated
</pre></div>
</div>
</div>
<div class="section" id="bower">
<h3>bower<a class="headerlink" href="#bower" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>cd .../lib  # where bower installs the libraries
bower list
</pre></div>
</div>
</div>
</div>
<div class="section" id="adhocracy-releases">
<h2>Adhocracy Releases<a class="headerlink" href="#adhocracy-releases" title="Permalink to this headline">¶</a></h2>
<p>Adhocracy uses <a class="reference external" href="http://semver.org/">semantic versions</a> with one
extra rule:</p>
<blockquote>
<div>Versions 0.0.* are considered alpha and do not have to follow the
major-minor-patch rules of semantic versioning.</div></blockquote>
<p>Git tag and <cite>setup.py</cite>-version must be the same string.</p>
<p>In order to create a new version, first make sure that:</p>
<blockquote>
<div><ol class="arabic simple">
<li>you are on master.  (this rule is motivated by the fact that
rebasing tags is really nothing we want to have to deal with.)</li>
<li>the last commit contains everything you want to release and
nothing else.</li>
<li>you have git-pushed everything to origin.</li>
</ol>
</div></blockquote>
<p>Then, to upgrade to version 0.0.3, carry out the following steps:</p>
<blockquote>
<div><ol class="arabic simple" start="4">
<li>update <cite>setup.py</cite> to the new version (search for <cite>name=...</cite> and
<cite>version=...</cite>).  Commit this change.</li>
<li><cite>git tag -a 0.0.3 -m &#8216;...&#8217;</cite>.  The commit comment can be
literally <cite>&#8216;...&#8217;</cite> if there is nothing special to say about this
release, or something like e.g. <cite>Presentation &lt;customer&gt;
&lt;date&gt;</cite>.</li>
<li><cite>git push &#8211;tags</cite> (I think <cite>git push</cite> and <cite>git fetch</cite> treat
tags and commits separately these days; for the convoluted
details, consult the man pages).</li>
</ol>
</div></blockquote>
<p>Browse existing tags and check out a specific release:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag
git checkout 1.8.19
</pre></div>
</div>
<p>Apply a hotfix to an old release:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout -b 1.8.19-hotfix-remote-root-exploit 1.8.19
...  # (edit)
git commit ...
git tag -a 1.8.20 -m &#39;Fix: remote-root exploit&#39;
</pre></div>
</div>
<p>There is more to tags, such as deleting and signing.  See <cite>git tag
&#8211;help</cite>.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="architecture/index.html" class="btn btn-neutral float-right" title="Architecture">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Tobias Krauthoff.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>